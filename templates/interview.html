{% extends "base.html" %}
{% block title %}Interview{% endblock %}

{% block content %}
<div class="row">

    <!-- Sidebar: question list -->
    <div class="col-md-3 mb-3">
        <div class="card shadow-sm">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-list-check me-2 text-primary"></i>Questions</h6>
            </div>
            <div class="card-body p-2" id="qSidebar">
                {% for q in interview.questions %}
                <div class="d-flex align-items-center gap-2 p-2 rounded mb-1 q-pill" id="pill-{{ loop.index0 }}"
                    onclick="jumpTo({{ loop.index0 }})" style="cursor:pointer;transition:background 0.15s">
                    <span class="badge rounded-pill q-dot" id="dot-{{ loop.index0 }}"
                        style="background:#e2e8f0;color:#64748b;width:26px;height:26px;display:flex;align-items:center;justify-content:center">
                        {{ loop.index }}
                    </span>
                    <span style="font-size:0.82rem">Q{{ loop.index }}</span>
                </div>
                {% endfor %}
                <div class="mt-3 p-2 rounded" style="font-size:0.75rem;background:#f8fafc">
                    <span style="color:#059669">●</span> Answered &nbsp;
                    <span style="color:#94a3b8">●</span> Not yet
                </div>
            </div>
        </div>
    </div>

    <!-- Main interview card -->
    <div class="col-md-9">
        <div class="card shadow">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0">
                    <i class="fas fa-{{ 'code' if interview.type == 'technical' else 'users' }} me-2 text-primary"></i>
                    {{ interview.type|capitalize }} Interview
                </h4>
                <span class="badge bg-primary" id="timer">--:--</span>
            </div>

            <div class="card-body">
                <!-- Progress bar -->
                <div class="progress mb-4" style="height:8px">
                    <div id="progressBar" class="progress-bar" role="progressbar" style="width:20%"></div>
                </div>

                <!-- Question + answer area injected by JS -->
                <div id="questionContainer"></div>

                <!-- Navigation -->
                <div class="d-flex justify-content-between mt-4">
                    <button id="prevBtn" class="btn btn-outline-secondary" disabled>
                        <i class="fas fa-chevron-left me-1"></i>Previous
                    </button>
                    <button id="nextBtn" class="btn btn-outline-primary">
                        Next <i class="fas fa-chevron-right ms-1"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Make interview data available to script.js
    const interview = {{ interview_json | safe }};

    // Sidebar jump function (called by inline onclick)
    function jumpTo(idx) {
        if (typeof saveCurrentAnswer === 'function') saveCurrentAnswer();
        currentIndex = idx;
        renderQuestion(idx);
    }

    // Override renderQuestion to also update sidebar pills
    const _origRender = window._smRenderHooked;
    document.addEventListener('DOMContentLoaded', () => {
        // Patch sidebar updates after script.js has run
        const _patchInterval = setInterval(() => {
            if (typeof renderQuestion !== 'undefined') {
                const origRender = renderQuestion;
                window.renderQuestion = function (idx) {
                    origRender(idx);
                    // Update sidebar
                    document.querySelectorAll('.q-pill').forEach((p, i) => {
                        p.style.background = i === idx ? 'rgba(79,70,229,0.1)' : '';
                        p.style.fontWeight = i === idx ? '600' : '';
                    });
                    document.querySelectorAll('.q-dot').forEach((dot, i) => {
                        const ans = (interview.questions[i].answer || '').trim();
                        dot.style.background = ans ? '#059669' : (i === idx ? '#4f46e5' : '#e2e8f0');
                        dot.style.color = ans || i === idx ? '#fff' : '#64748b';
                    });
                };
                clearInterval(_patchInterval);
            }
        }, 50);
    });
</script>
{% endblock %}